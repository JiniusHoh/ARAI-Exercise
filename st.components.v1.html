html_code = """
<video id="localVideo" autoplay playsinline muted></video>
<img id="processedFrame" style="display: block; margin-top: 20px;" />
<script>
  const videoElement = document.getElementById('localVideo');
  const processedFrameElement = document.getElementById('processedFrame');
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => {
      videoElement.srcObject = stream;
      const ws = new WebSocket('ws://localhost:8765');
      ws.onopen = () => {
        setInterval(() => {
          const canvas = document.createElement('canvas');
          canvas.width = videoElement.videoWidth;
          canvas.height = videoElement.videoHeight;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
          const dataUrl = canvas.toDataURL('image/jpeg');
          const base64 = dataUrl.split(',')[1];
          ws.send(base64);
        }, 100);
      };
      ws.onmessage = (event) => {
        processedFrameElement.src = 'data:image/jpeg;base64,' + event.data;
      };
    })
    .catch(error => {
      console.error('Error accessing webcam:', error);
    });
</script>
"""

st.components.v1.html(html_code, height=600)
